<!DOCTYPE html>
<html lang="en">
<head>
    {{template "header" .}}
    <title>Panda-DB | Genome Browser</title>

    <!-- 导入igv2.10.5 -->
    <script src="https://cdn.jsdelivr.net/npm/igv@2.10.5/dist/igv.min.js"></script>
    <!-- Data manipulation -->
    <script type="text/javascript" src="../static/js/listGenerate.js"></script>

</head>
<body>

    {{template "navigation" .}}

<div class="container">
    <h2 class="page-title-txt">Genome Browser</h2>
</div>



<div class="container browser-row well">
    <div class="row">

        <div class="col-lg-4 col-lg-offset-1 col-md-4 col-sm-12">
            <h3>
                "reference strain"
            </h3>
            <form class="form-inline pull-xs-right">
                <input class="form-control" id="filter" type="text" style="width:100%; margin-bottom: 2%;" 
                placeholder="etc...." autocomplete="off">
            </form>
            <div style="height:230px; overflow:scroll;">
                <table id="browser_strain_list" class="table table-striped table-hover table-condensed">
                    <tbody class="searchable" id="genetic" style="overflow: scroll">
                    <tbody class="searchable" style="overflow: scroll;"></tbody>
                </table>

            </div> 
        </div>

        <div class="col-lg-4 col-md-3 col-sm-12">
            <form>
                <h3>
                    Gene Search
                </h3>
                <div class="form-group">
                    <input type="text" class="form-control" id="gene-search" style="margin-bottom: 5px;" placeholder="Gene Search (e.g. trt-1)">
                </div>
            </form>    
            <h3>Tracks</h3>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" checked class="track-sele normal-track" value="Genes">Genes
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" class="track-sele normal-track" value="Genes">structure variation
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" class="track-sele normal-track" value="Genes">copy number
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" class="track-sele normal-track" value="Genes">hyper divergent
                    </label>
                </div>
        </div>

        <div class="col-lg-3 col-md-6" role="complementary">
            <section id="block-block-5" class="block block-block clearfix">
                <h3 class="block-title" style="text-align: center;">Genetic Summary</h3>
                <table class="datasum" style="margin: auto;" ><tr><th>Type</th><th style="text-align:right;">Records</th></tr><tr><td>Organism</td><td style="text-align:right;">91</td></tr><tr><td>Assembly</td><td style="text-align:right;">55624</td></tr><tr><td>Gene</td><td style="text-align:right;">403636</td></tr><tr><td>mRNA</td><td style="text-align:right;">402784</td></tr><tr><td>Protein</td><td style="text-align:right;">402784</td></tr><tr><td>rRNA</td><td style="text-align:right;">1548</td></tr><tr><td>tRNA</td><td style="text-align:right;">5543</td></tr><tr><td>Exon</td><td style="text-align:right;">926116</td></tr><tr><td>DAN Transposon</td><td style="text-align:right;">35162</td></tr><tr><td>LINE Element</td><td style="text-align:right;">129061</td></tr><tr><td>SINE Element</td><td style="text-align:right;">50997</td></tr><tr><td>LTR Retrotransposon</td><td style="text-align:right;">222617</td></tr><tr><td>Repeat Region</td><td style="text-align:right;">32382</td></tr></table>
            </section>
        </div >
    </div>

</div>

<div class="igv">
    <div class="container">
        <!-- igv功能模块 -->
            <div class="col-lg-12 col-md-10">
                <div id="igv-div"></div>
                <script type="text/javascript">
                    //import igv from "https://cdn.jsdelivr.net/npm/igv@2.10.4/dist/igv.esm.min.js";
                    var igvDiv = document.getElementById("igv-div");
                    const options = {
                            reference: {
                                "id": "Panda",
                                "name": "Panda 2021",
                                "fastaURL": "{{ .root}}/Ailuropoda_melanoleuca.ASM200744v2.dna_sm.primary_assembly.all.fa",
                                "indexURL": "{{ .root}}/Ailuropoda_melanoleuca.ASM200744v2.dna_sm.primary_assembly.all.fa.fai",
                                "tracks": [
                                    {
                                        type: "alignment",
                                        format: "bam",
                                        name: "NA12889",
                                        url: "gs://genomics-public-data/platinum-genomes/bam/NA12878_S1.bam",
                                        indexURL: "gs://genomics-public-data/platinum-genomes/bam/NA12878_S1.bam.bai",
                                        sort: {
                                            chr: "chr1",
                                            position: 155155358,
                                            option: "BASE",
                                            direction: "ASC"
                                        },
                                    },
                                ]
                            },
                            "locus": "2:24,949,203-24,963,009",
                        };


                    document.addEventListener("DOMContentLoaded", function() {
                        igv.createBrowser(igvDiv, options)
                            .then( (browser) => {igv.browser = browser} );
                    });

                    function LoadTrack(n) {
                        i = {
                            type: 'wig',
                            format: 'bigwig',
                            url: 'https://s3.amazonaws.com/igv.broadinstitute.org/data/hg19/encode/wgEncodeBroadHistoneGm12878H3k4me3StdSig.bigWig',
                            name: n
                        };
                        console.log(i);
                        console.log(igv.browser);
                        console.log(igv);
                        // dont fix
                        //igv.browser.loadTrack(i);

                            // .then( (newTrack) => alert("Track loaded: " + newTrack.name) )
                            // .catch( (error) => console.log("A error happened") )
                    }

                    //document.getElementById("FDSW202100238-1r.bam").onclick = LoadTrack("FDSW202100238-1r.bam");
                </script>

            </div>
        </div>
    </div>
</div>

{{template "footer" .}}

</body>
</html>
